1. **멀티 프로세스와 멀티 스레드의 개념과 각각의 장단점을 설명해주세요.** 

- 답 : **[멀티 프로세스의 개념]**

컴퓨터 사이언스에는 Decomposition이란 개념이 있다. 복잡한 소프트웨어를 한 덩어리로 관리하기 보단 Manageable한 크기까지 쪼개는 것을 말한다. 이것이 Operating System에도 동일하게 적용되어 시스템을 관리하기 용이하며 곧바로 구현 가능한 단위까지 쪼갠 것이 바로 ‘Process’이다. 

그리고 Process는 CPU에 의해서 실행되는 Program(Program in execution)을 말한다. Program은 인간이 프로그래밍 언어로 서술한 데이터 구조 및 알고리즘을 지칭한다. 그리고 이 Program은 컴퓨터 Memory에 로드되고 CPU에 의해서 실행된다. 이때 ‘실행’이란 행위는 CPU가 메모리에 로드된 데이터 구조 및 알고리즘을 순차적으로 읽어나가는 ‘흐름’을 뜻한다. 즉, 프로세스란 일종의 ‘프로그램 실행 흐름’이라고 말할 수 있다.

이러한 프로그램 실행 흐름은 CPU 관점 또는 Memory 관점에서 서술될 수 있는데, 이때 ‘멀티 프로세스(Multi-processing)’는 CPU 관점에서 CPU가 여러 개의 프로세스(프로그램 실행 흐름)을 갖는 것을 말한다. 덧붙여 Memory 관점에서 RAM 상에 Active한 Process가 여러 개 있는 것은 Multi-programming이라고 한다.

**[멀티 스레드의 개념]**

Thread는 process의 개념이 확장되면서 나온 것이다. 이 확장된 개념에서는 ‘프로그램 실행 흐름’에 적확하게 대응되는 것을 thread라고 하며, 이런 thread를 관리하는 컨테이너를 process라고 본다. 그래서 process 관점에서 여러 개의 thread를 갖고 있는 것을 멀티스레드(multithread)라고 한다. 또한 이 확장된 개념 안에서 멀티프로세스는 CPU가 thread를 관리하는 컨테이너인 Process를 여러 개 갖는 것을 말한다고 볼 수 있다.

**[멀티 프로세스의 장점]**

1. 병렬처리 가능
    1. 현대 컴퓨터에는 기본적으로 다중 CPU 코어가 탑재되어 있다. 그렇기 때문에 여러 개의 실행 흐름을 여러 개의 CPU 코어 분산하여 프로그램을 병렬처리 할 수 있다.
2. Google Chrome : 안정성
    1. 멀티 프로세스의 구조를 가진 대표적인 소프트웨어로는 Chrome이 있다. Chrome은 탭마다 하나의 프로세스를 할당한다. 이는 특정 프로세스가 죽은 경우에 전체 소프트웨어가 죽지 않도록 하기 위함이다. 즉, Chrome의 탭 중 하나가 먹통이 되더라도 다른 탭은 여전히 사용 가능한 셈이다. 이처럼 multiprocess 환경에서는 각각의 프로세스가 독립적으로 실행되기 때문에 에러가 전파되지 않아 소프트웨어의 안정성을 향상시킬 수 있다. 
3. Apache : 확장성
    1. 멀티 프로세스 구조를 가진 또 다른 소프트웨어로 Apache가 있다. 이는 대표적인 웹서버로 사용되었던 것으로 사용자 요청이 들어올 때마다 해당 요청을 처리하기 위한 프로세스를 생성한다.(Process per request model) 그래서 사용자의 요청 수에 따라 동적으로 프로세스를 늘리거나 줄여야 하는데 멀티 프로세스 구조는 이에 적합하다.

**[멀티 프로세스의 단점]**

1. Context Switching
    1. 프로세스는 일종의 ‘프로그램 실행 흐름’이라고 하였다. 멀티 프로세싱 환경에서는 CPU 하나가 여러 개의 실행 흐름을 갖기에 각각의 프로세스마다 어디까지 실행했는지, 마지막 실행 상태가 어떠한 지 따로 저장해두어야 한다. 이를 PCB라는 구조체에 저장하며, 이것은 운영체제가 관리하는 메모리에 저장되어 있다. 그래서 만약 A라는 프로세스를 실행하다가 B라는 프로세스로 바꿔서 실행하고 싶으면 A의 상태 등을 포함하는 전체적인 정보를 A의 PCB에 저장하고, B의 전체적인 맥락을 B의 PCB에서 읽어와야 한다. 이와 같은 실행할 프로세스의 맥락 전환(Context Switching)에는 메모리 읽기, 쓰기와 같은 행위가 동반되며, 이로부터 오버헤드가 발생한다. 멀티 프로세싱 환경은 잦은 Context Swiching 발생할 가능성이 높으며, 잦은 Context Switching이 발생하면, 필연적으로 오버헤드 비용이 높아지게 된다. 이러한 오버헤드 비용이 멀티 프로세스의 단점이다. 
2. IPC 비용
    1. 프로세스는 위에서 언급했듯이 서로 독립적이다. 그래서 자신들이 사용하는 데이터를 기본적으로 서로 공유하지 않는다. 따라서 프로세스 간의 통신(IPC, Inter Process Communication)을 하기 위해선 메모리를 공유하거나, 메세지를 서로 주고 받는 방식을 사용해야 한다. 이 또한 메모리 읽기, 쓰기 작업이 동반되며, IPC 구현 시에 사용되는 Buffer로 인해서 성능이 저하되거나 구현이 어려워지는 문제가 생길 수 있다. 
3. Apache, Google Chrome : 프로세스는 메모리를 많이 쓴다. 
    1. 프로세스는 기본적으로 필요로 하는 메모리양이 있다. 그래서 많은 프로세스가 생기게 된다면 컴퓨터 자원이 부족해질 수 있다. 이 문제는 Apache 웹서버가 겪었던 C10K에서도 찾아볼 수 있다. 인터넷이 발전하면서 사용자의 요청의 수가 전보다 폭발적으로 늘어나게 되었다. 이로 인해서 Apache 웹서버가 만들어야 할 프로세스의 수도 증가하게 되었는데, 결론적으로는 Process가 필요로 하는 메모리가 적지 않기 때문에 웹서버에서 메모리 부족 문제가 발생하게 되었다. 또한 Google Chrome에서도 멀티 프로세스로 인해서 메모리가 부족해지는 경우를 대비하여 여러 프로세스를 하나로 합쳐서 사용할 수 있는 방법을 만들어 놓았다.
4. 데드락
    1. 병렬로 프로세스가 실행되고, 이들 간의 자원 공유가 있을 시에 경합 조건이 발생한다. 프로세스 A는 a 자원을 점유하고 b 자원의 점유를 얻고자 한다. 그리고 프로세스 B는 b 자원을 점유하고 a 자원을 점유하고자 한다. 그렇다면 프로세스 A와 B는 서로가 원하는 자원을 점유하고 있기 때문에 영원히 상대편 프로세스가 자원 점유를 풀어줄 때까지 기다린다. 이러한 데드락이 멀티 프로세싱에서 발생한다.

**[멀티 스레드의 장점]**

1. 병렬처리 가능
    1. 멀티 프로세스와 동일하게 CPU가 여러 개의 실행 흐름을 갖도록 만들 수 있다. 그래서 병렬처리가 가능하다. 구체적인 예를 들자면, 웹 홈페이지에 접속하여 Input 창에 데이터를 입력 받는 스레드와 입력 받은 데이터의 유효성 검증을 하는 프로세스를 동시에 실행시켜 입력과 검증을 동시에 처리할 수 있다.
2. PCB 공유
    
    스레드는 프로세스의 컨텍스트 정보가 저장되어 있던 PCB 내부에 생성된다. 그래서 PCB 내부 데이터를 서로 공유하며 사용할 수 있다. 이런 구조로 인해 멀티 스레드는 아래와 같은 장점을 갖는다.
    
    1. 메모리 절약
        1. 위에서 프로세스는 스레드란 실행 흐름을 관리하는 컨테이너로 볼 수 있다고 하였다. 이는 실제로 프로세스의 Context를 저장하는 PCB 내부에서 스레드를 관리하기 때문이다. 즉, PCB 내부에 스레드와 관련된 데이터를 저장하고, 이를 통해 스레드들은 같은 PCB에서 코드, 데이터 등의 자원을 공유한다. 이러한 구조는 기존에는 실행 흐름을 사용할 때마다 만들어야 했던 데이터들을 공유할 수 있게 하여 메모리를 절약할 수 있도록 해준다.
    2. IPC 비용 절약
        1. 스레드는 PCB 내부에 이미 공유하는 데이터가 있기 때문에 따로 커널을 거치지 않고 데이터를 공유할 수 있다. 그래서 기존의 IPC 방법보다 효율적으로 데이터를 주고 받을 수 있다.
    3. 컨텍스트 스위칭 오버헤드 비용 절약
        1. 스레드 또한 컨텍스트 스위칭이 발생한다. 그러나 스레드 간에 공유하는 데이터가 존재하기 때문에 기존의 프로세스 컨텍스트 스위칭 보단 더 적은 데이터만을 스위칭 하면 된다. 이러한 구조로 인해서 컨텍스트 스위칭 오버헤드 비용이 절약된다.
    4. Thread per Request 모델 구현 가능
        1. 위에서 제시된 장점을 활용하면 기존에 리소스가 많이 필요하여 문제가 됐던 Process per request의 문제를 해결할 수 있다. 즉, 사용자 요청마다 하나의 스레드를 할당하여 해당 요청을 기존보다 훨씬 낮은 비용으로 처리할 수 있게 된다.

**[멀티스레드의 단점]**

1. 안정성
    1. 만약 멀티 스레딩 도중에 하나의 스레드에서 에러가 발생하면 전체 소프트웨어로 에러가 전파된다. 그래서 하나의 스레드로 인해서 모든 시스템이 다운될 수 있다.
2. 동기화
    1. 멀티 스레드를 하는 순간부터, PCB 내부에 있는 데이터를 스레드끼리 공유하게 된다. 즉, 여러 개의 스레드가 단일 자원을 동시에 사용할 수 있게 된다. 이런 경우에 특정 자원에 대한 점유를 제어하기 위해서 동기화란 방법을 사용한다. 그러나 동기화는 병목 현상을 유발할 수 있으며, 병목 현상으로 시스템 성능이 저하될 수 있다.
3. 컨텍스트 스위칭
    1. 멀티 스레드는 멀티 프로세싱보단 덜 하지만 여전히 컨텍스트 스위칭이 발생한다. 따라서 컨텍스트 스위칭에 의한 오버헤드가 여전히 단점으로 여겨진다.
4. 데드락
    1. 병렬 처리와 동시에 자원 공유가 일어나게 되면 언제나 데드락이 발생할 수 있다. 따라서 멀티 스레딩 환경에서도 데드락이 발생할 수 있다.

    <br>
   
    1-1. **멀티 스레드 환경에서 스레드는 많으면 많을수록 좋을까요? 이유와 함께 답변해주세요.**

    - 답 : 멀티 스레드는 많으면 많을수록 좋지 않다. 이를 암달의 법칙을 이용하여 추론하면 아래와 같다.

1. 암달에 법칙에 의하면 프로그램 내부에 병렬 처리가 가능한 부분이 95%일 때 코어의 개수를 무한히 늘려도 시스템의 성능은 20배 이상 증가하지 않는다. 
2. 즉, 코어가 무수히 많고, 이 하드웨어에서 멀티 스레드를 통해 프로그램의 95퍼센트를 병렬 처리하여도 성능은 20배 이상 향상시킬 수 없다.
3. 즉, 스레드가 아무리 많아져도 성능 향상에는 한계가 있다.

이론적인 한계는 위와 같다. 또한 병렬 처리에도 프로세스나 스레드에 threshold가 존재한다. 너무 많은 스레드가 생기면, 모든 스레드들은 단지 cpu를 스쳐 지나가게만 될 뿐 어떤 작업을 할 수 있는 시간을 할당 받지 못한다. 이러한 이유로 인해서 무한히 많은 스레드는 적절치 않다. 즉, 스레드의 개수가 일정 수준을 넘어가게 되면 컴퓨터는 먹통이 된다. 그래서 오히려 하드웨어 스펙, 자금, 처리하려는 일의 특성에 따라서 스레드의 적정 개수를 계산하여 이를 통해 스레드풀을 만들어서 써야 한다.

<br>

---
2. **컨텍스트 스위칭이란 무엇인지, 그리고 컨텍스트 스위칭으로 인한 문제가 무엇이 있는지 최대한 자세하게 설명해주세요.**

- 답 : 컨텍스트 스위칭이란 CPU가 실행시키고 있던 프로세스의 정보를 메모리에 적재된 PCB에 저장하고, 다음으로 실행할 프로세스의 PCB 정보를 CPU에 로드함으로써 CPU의 실행 흐름을 전환하는 일을 말한다. 

컨텍스트 스위칭은 위에서 서술했듯이 그 과정 속에서 메모리에 데이터를 읽고 씀으써 오버헤드가 발생한다는 점이다. 그리고 이로 인해서 멀티 프로세싱을 하는 경우에는 프로그램의 응답 속도를 현저하게 저하시킬 수도 있다. 또한 컨텍스트 스위칭으로 인해 프로세서 내부의 캐시 값이 삭제되어서 캐시 미스를 유발할 수 있다.

<br>

---
3. **데드락에 대해 설명하고, 해결 방법을 아는대로 설명해주세요.**

- 답 : 데드락은 프로세스나 스레드가 서로 필요한 자원을 점유하고 있어서 모든 프로세스가 상대 프로세스 또는 스레드가 자신이 필요한 자원의 할당을 해제해줄 때까지 기다리는 상황을 말한다.

데드락 해결 방법은 아래와 같다

1. 예방
    1. 데드락이 발생할 수 있는 조건을 사전에 예방하는 것
        1. 상호 배제 부정 : 읽기 전용 파일과 같은 것들만 공유 자원으로 사용
        2. 점유 및 대기 부정 : 자원을 점유하지 않고 있을 때만 다른 자원 점유 요청 가능
        3. 비선점 부정 : 다른 프로세스 또는 스레드에게 점유된 자원을 요청하는 경우에 이미 보유 중인 자원을 모두 점유 해제하고 원하는 자원을 기다리게 만든다
        4. 순환 대기 부정 : 자원에 번호를 붙이고 번호 순서대로 프로세스가 자원을 요청하도록 만든다.
2. 회피
    1. 은행원 알고리즘 사용
    2. 자원할당 그래프 알고리즘 사용
3. 탐지
    1. wait-for 그래프 사용
    2. 은행원 알고리즘 사용
4. 복구